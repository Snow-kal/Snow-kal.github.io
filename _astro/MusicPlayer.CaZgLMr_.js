import{o as J,a as K,i as N}from"./lifecycle.Brtat5it.js";import{c as O,f as Q,a as Y,p as Z,b as ee,s as r,m as o,g as e,$ as b,d as a}from"./template.wmnhfMC7.js";import{e as k}from"./events.DAjQeYci.js";import{i as te}from"./if.DqQt15JA.js";import"./functions.WhpeioxD.js";import"./config.DOCV-rfy.js";import"./zh_TW.BW8a2Ucy.js";function ue(x,B){ee(B,!1);let l=a(!1),h=a(0),c=a(0),m=a(.7),F=a(!1),f=a(!1),g=a(!1),E=a(0),R=a(""),L=a(!1),p=a({title:"Sample Song",artist:"Sample Artist",cover:"/favicon/favicon.ico",url:"",duration:0}),i=a([]),s=a(0),t=a(),y=a();function w(){if(e(i).length<=1)return;let n;if(e(g))do n=Math.floor(Math.random()*e(i).length);while(n===e(s)&&e(i).length>1);else n=e(s)<e(i).length-1?e(s)+1:0;W(n)}function W(n){if(n<0||n>=e(i).length)return;const d=e(l);r(s,n),e(t)&&e(t).pause(),C(e(i)[e(s)]),(d||!e(l))&&setTimeout(()=>{e(t)&&(e(t).readyState>=2?e(t).play().catch(()=>{}):e(t).addEventListener("canplay",()=>{e(t).play().catch(()=>{})},{once:!0}))},100)}function q(n){return n.startsWith("http://")||n.startsWith("https://")||n.startsWith("/")?n:`/${n}`}function C(n){!n||!e(t)||(r(p,{...n}),n.url?(r(f,!0),o(t,e(t).currentTime=0),r(h,0),r(c,n.duration??0),e(t).removeEventListener("loadeddata",M),e(t).removeEventListener("error",T),e(t).removeEventListener("loadstart",A),e(t).addEventListener("loadeddata",M,{once:!0}),e(t).addEventListener("error",T,{once:!0}),e(t).addEventListener("loadstart",A,{once:!0}),o(t,e(t).src=q(n.url)),e(t).load()):r(f,!1))}let v=!1;function M(){if(r(f,!1),e(t)?.duration&&e(t).duration>1&&(r(c,Math.floor(e(t).duration)),e(i)[e(s)]&&o(i,e(i)[e(s)].duration=e(c)),o(p,e(p).duration=e(c))),e(l)){const n=e(t).play();n!==void 0&&n.catch(d=>{console.warn("自动播放被拦截，等待用户交互:",d),v=!0})}}function S(){if(v&&e(t)&&e(l)){const n=e(t).play();n!==void 0&&n.then(()=>{v=!1}).catch(()=>{})}}function T(n){r(f,!1),P(`无法播放 "${e(p).title}"，正在尝试下一首...`),e(i).length>1?setTimeout(()=>w(),1e3):P("播放列表中没有可用的歌曲")}function A(){}function P(n){r(R,n),r(L,!0),setTimeout(()=>{r(L,!1)},3e3)}let $=a(!1),_=!1,D=null,u=null;function U(n){_&&(r($,!0),!u&&(u=requestAnimationFrame(()=>{j(n.clientX),u=null})))}function X(){_=!1,r($,!1),D=null,u&&(cancelAnimationFrame(u),u=null)}function j(n){if(!e(t)||!e(y))return;const d=D||e(y).getBoundingClientRect(),H=Math.max(0,Math.min(1,(n-d.left)/d.width));r(m,H),o(t,e(t).volume=e(m)),r(F,e(m)===0)}function z(){e(t)&&(e(t).addEventListener("play",()=>{r(l,!0)}),e(t).addEventListener("pause",()=>{r(l,!1)}),e(t).addEventListener("timeupdate",()=>{r(h,e(t).currentTime)}),e(t).addEventListener("ended",()=>{e(E)===1?(o(t,e(t).currentTime=0),e(t).play().catch(()=>{})):e(E)===2||e(g)?w():r(l,!1)}),e(t).addEventListener("error",n=>{r(f,!1)}),e(t).addEventListener("stalled",()=>{}),e(t).addEventListener("waiting",()=>{}))}const I=["click","keydown","touchstart"];J(()=>{r(t,new Audio),o(t,e(t).volume=e(m)),z(),I.forEach(n=>{document.addEventListener(n,S,{capture:!0})})}),K(()=>{typeof document<"u"&&I.forEach(n=>{document.removeEventListener(n,S,{capture:!0})}),e(t)&&(e(t).pause(),o(t,e(t).src=""))}),N();var V=O();k("mousemove",b,U),k("mouseup",b,X);var G=Q(V);te(G,n=>{}),Y(x,V),Z()}export{ue as default};
